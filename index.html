<!DOCTYPE html>
<html>
<head>
    <title>OS Anomaly Monitor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container mt-4">
    <h2 class="text-center mb-4">OS Resource Anomaly Monitor</h2>

    <div class="d-flex justify-content-center mb-3">
        <div id="no-anomalies" class="alert alert-success text-center" style="display:none;">
            âœ… No anomalies detected!
        </div>
    </div>

    <div class="card shadow-sm mb-3">
        <div class="card-header text-center">
            Anomalies Table
        </div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0" id="process-table">
                <thead class="table-dark">
                    <tr>
                        <th>PID</th>
                        <th>Name</th>
                        <th>CPU (%)</th>
                        <th>Memory (%)</th>
                        <th>Disk (MB)</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
async function fetchAnomalies() {
    const response = await fetch("/data");
    const data = await response.json();
    const tbody = document.querySelector("#process-table tbody");
    const noAnomaliesDiv = document.getElementById("no-anomalies");

    tbody.innerHTML = "";
    if (data.length === 0) {
        noAnomaliesDiv.style.display = "block";
        return;
    } else {
        noAnomaliesDiv.style.display = "none";
    }

    data.forEach(proc => {
        const cpuColor = proc.cpu > 70 ? "bg-danger text-white" :
                         proc.cpu > 40 ? "bg-warning" : "bg-success text-white";
        const memColor = proc.memory > 70 ? "bg-danger text-white" :
                         proc.memory > 40 ? "bg-warning" : "bg-success text-white";
        const diskMB = (proc.disk / (1024*1024)).toFixed(2);

        const row = `<tr class="anomaly">
            <td>${proc.pid}</td>
            <td>${proc.name}</td>
            <td><span class="badge ${cpuColor}">${proc.cpu}</span></td>
            <td><span class="badge ${memColor}">${proc.memory}</span></td>
            <td>${diskMB}</td>
        </tr>`;
        tbody.innerHTML += row;
    });
}

// Refresh every 5 seconds
setInterval(fetchAnomalies, 5000);
fetchAnomalies();
</script>
</body>
</html>
